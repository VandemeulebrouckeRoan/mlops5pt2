name: Kubernetes Pod Test

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Generate random ID
      shell: pwsh
      run: echo "ID=$(Get-Random -Maximum 99999)" >> $env:GITHUB_ENV

    - name: Apply Pod to Kubernetes
      shell: pwsh
      run: |
        (Get-Content k8s/hello-pod.yaml).Replace("{ID}", "$env:ID") | Set-Content k8s/hello-pod-gen.yaml
        kubectl apply -f k8s/hello-pod-gen.yaml

    - name: Check pods
      run: kubectl get pods
